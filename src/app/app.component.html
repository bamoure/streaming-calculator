<div [ngClass]="{'dark-theme': isDarkTheme | async}">
  <div class="mat-app-background">
    <mat-toolbar color="primary">
      <span>Streaming Calculator</span>
      <mat-slide-toggle [checked]="isDarkTheme | async" (change)="toggleDarkTheme($event.checked)">
        <mat-icon *ngIf="isDarkTheme | async; else lightTheme">brightness_3</mat-icon>
        <ng-template #lightTheme>
          <mat-icon>brightness_5</mat-icon>
        </ng-template>
      </mat-slide-toggle>
    </mat-toolbar>

    <h2 class="header">Calculate the amount of CO2 emissions generated by streaming video...</h2>

    <form [formGroup]="form">
      <mat-form-field appearance="outline">
        <mat-label>Hours</mat-label>
        <input matInput type="number" min="0" formControlName="hours" required />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Device type</mat-label>
        <mat-select formControlName="device" required>
          <mat-option *ngFor="let device of deviceTypes" [value]="device">{{ device.label }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Network type</mat-label>
        <mat-select formControlName="network" required>
          <mat-option *ngFor="let network of networkTypes" [value]="network">{{ network.label }}</mat-option>
        </mat-select>
      </mat-form-field>
    </form>

    <div class="figure-container">
      <div class="donut-container">
        <svg width="100%" height="100%" viewBox="0 0 42 42" class="donut">
          <circle class="donut-hole" cx="21" cy="21" r="15.91549430918954" fill="transparent"></circle>
          <circle class="donut-ring" cx="21" cy="21" r="15.91549430918954" fill="transparent" stroke="#d2d3d4"
            stroke-width="3">
          </circle>

          <circle class="donut-segment stroke-primary" cx="21" cy="21" r="15.91549430918954" fill="transparent"
            stroke-width="3" *ngIf="totalEmissions"
            [attr.stroke-dasharray]="deviceConsumption / (deviceConsumption + networkConsumption) * 100 + ' ' + networkConsumption / (deviceConsumption + networkConsumption) * 100"
            stroke-dashoffset="0"></circle>
          <circle class="donut-segment stroke-accent" cx="21" cy="21" r="15.91549430918954" fill="transparent"
            stroke-width="3" *ngIf="totalEmissions"
            [attr.stroke-dasharray]="networkConsumption / (deviceConsumption + networkConsumption) * 100 + ' ' + deviceConsumption / (deviceConsumption + networkConsumption) * 100"
            [attr.stroke-dashoffset]="100 - (deviceConsumption / (deviceConsumption + networkConsumption) * 100)">
          </circle>

          <g class="chart-text fill-text-color">
            <text x="50%" y="50%" class="chart-number">
              {{totalEmissions || '--'}}
            </text>
            <text x="50%" y="50%" class="chart-label">
              Total CO2 emissions (gCO2eq)
            </text>
          </g>
        </svg>

        <div class="figure-caption" *ngIf="totalEmissions">
          <p>CO2 emissions from {{ hoursValue }} hours on a {{ deviceValue.label }} with {{ networkValue.label }}.</p>
          <ul class="caption-list">
            <li>
              <span class="circle background-primary"></span> Device consumption ({{ deviceValue.value }} kWh)
            </li>
            <li>
              <span class="circle background-accent"></span> Network consumption ({{ networkValue.value }} kWh)
            </li>
          </ul>
        </div>
      </div>

      <!-- <ng-template #noData> -->
      <!-- Icon by surang from FlatIcon: https://www.flaticon.com/authors/surang -->
      <!-- <img src="assets/co2.svg"> -->
      <!-- </ng-template> -->
    </div>
  </div>
</div>
